<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Trang chủ quản trị</title>

    <!-- Custom fonts for this template-->
    <link
      href="./vendor/fontawesome-free/css/all.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <!-- end font -->

    <!-- Custom styles for this template-->
    <link href="./css/sb-admin-2.css" rel="stylesheet" />
    <!-- SweetAlert -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body id="page-top">
    <!-- Page Wrapper -->
    <div id="wrapper">
      <!-- Sidebar -->
      <ul
        class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion"
        id="accordionSidebar"
      >
        <!-- Sidebar - Brand -->
        <a
          class="sidebar-brand d-flex align-items-center justify-content-center"
          href="index.html"
        >
          <div class="sidebar-brand-text mx-3">SKYNET</div>
        </a>

        <!-- Divider -->
        <hr class="sidebar-divider my-0" />

        <!-- Nav Item - Dashboard -->
        <li class="nav-item active">
          <a class="nav-link" href="index.html">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Dashboard</span></a
          >
        </li>

        <!-- Divider -->
        <hr class="sidebar-divider" />

        <!-- Heading -->
        <div class="sidebar-heading">Interface</div>

        <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
            <a
              class="nav-link collapsed"
              href="#"
              data-toggle="collapse"
              data-target="#collapseTwo"
              aria-expanded="true"
              aria-controls="collapseTwo"
            >
              <i class="fas fa-fw fa-cog"></i>
              <span>Bài viết</span>
            </a>
            <div
              id="collapseTwo"
              class="collapse"
              aria-labelledby="headingTwo"
              data-parent="#accordionSidebar"
            >
              <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item" href="post-pending.html"
                  >Bài viết chờ duyệt</a
                >
                <a class="collapse-item" href="post-active.html"
                  >Bài viết đã duyệt</a
                ><a class="collapse-item" href="add-post.html">Thêm bài viết</a>
              </div>
            </div>
          </li>
        </ul>
        <!-- End of Sidebar -->

      <!-- Content Wrapper -->
      <div id="content-wrapper" class="d-flex flex-column">
        <!-- Topbar -->
        <nav
        class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow"
      >
        <!-- Sidebar Toggle (Topbar) -->
        <button
          id="sidebarToggleTop"
          class="btn btn-link d-md-none rounded-circle mr-3"
        >
          <i class="fa fa-bars"></i>
        </button>

        <!-- Topbar Navbar -->
        <ul class="navbar-nav ml-auto">
          <!-- Nav Item - Search Dropdown (Visible Only XS) -->
          <li class="nav-item dropdown no-arrow d-sm-none">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              id="searchDropdown"
              role="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <i class="fas fa-search fa-fw"></i>
            </a>
            <!-- Dropdown - Messages -->
            <div
              class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
              aria-labelledby="searchDropdown"
            >
              <form class="form-inline mr-auto w-100 navbar-search">
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control bg-light border-0 small"
                    placeholder="Search for..."
                    aria-label="Search"
                    aria-describedby="basic-addon2"
                  />
                  <div class="input-group-append">
                    <button class="btn btn-primary" type="button">
                      <i class="fas fa-search fa-sm"></i>
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </li>

          <div class="topbar-divider d-none d-sm-block"></div>

          <!-- Nav Item - User Information -->
          <li class="nav-item dropdown no-arrow">
            <a
              class="nav-link dropdown-toggle"
              href="#"
              id="userDropdown"
              role="button"
              data-toggle="dropdown"
              aria-haspopup="true"
              aria-expanded="false"
            >
              <span class="mr-2 d-none d-lg-inline text-gray-600 small"
                ></span
              >
              <img
                class="img-profile rounded-circle"
                src="img/undraw_profile.svg"
              />
            </a>
            <!-- Dropdown - User Information -->
            <div
              class="dropdown-menu dropdown-menu-info dropdown-menu-right shadow animated--grow-in"
              aria-labelledby="userDropdown"
            >
              <div class="dropdown-divider"></div>
              <a
                class="dropdown-item"
                href="#"
                id="logoutBtn"
              >
                <i
                  class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"
                ></i>
                Logout
              </a>
            </div>
          </li>
        </ul>
      </nav>
      <!-- End of Topbar -->
        <!-- Main Content -->
        <div class="container mt-5">
          <h2>Sửa bài đăng</h2>
          <form id="postForm">
            <div class="form-group">
              <label for="title">Tiêu đề:</label>
              <input
                type="text"
                class="form-control"
                id="title"
                name="title"
                required
              />
            </div>
            <div class="form-group">
              <label for="content">Nội dung:</label>
              <textarea></textarea>
            </div>
            <div class="form-group">
              <label for="thumbnailUrl">URL ảnh đại diện:</label>
              <input
                type="file"
                class="form-control-file"
                id="thumbnailUrl"
                accept="image/*"
                required="true"
              />
            </div>
            <button type="submit" class="btn btn-primary">Edit bài đăng</button>
          </form>
        </div>
        <!-- End of Main Content -->

        <!-- Footer -->
        <footer class="sticky-footer bg-white">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Trang quản trị của web tech.</span>
            </div>
          </div>
        </footer>
        <!-- End of Footer -->
      </div>
      <!-- End of Content Wrapper -->
    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div
      class="modal fade"
      id="logoutModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
            <button
              class="close"
              type="button"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            Select "Logout" below if you are ready to end your current session.
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-secondary"
              type="button"
              data-dismiss="modal"
            >
              Cancel
            </button>
            <a class="btn btn-primary" href="login.html">Logout</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="./vendor/jquery/jquery.min.js"></script>
    <script src="./vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="./vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="./js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="./vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="./js/demo/chart-area-demo.js"></script>
    <script src="./js/demo/chart-pie-demo.js"></script>
    <!-- Place the first <script> tag in your HTML's <head> -->
      <script>
        var userInfo = JSON.parse(localStorage.getItem('userInfo'));
        if (userInfo) {
   
      document.querySelector('.text-gray-600.small').textContent = userInfo.name;
  
      var dropdownMenu = document.querySelector('.dropdown-menu-info');
      console.log(dropdownMenu)
      dropdownMenu.innerHTML = '';
  
      var accessRightItem = document.createElement('a');
      accessRightItem.classList.add('dropdown-item');
      accessRightItem.innerHTML = `
          <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i> ${userInfo.accessRight}
      `;
      dropdownMenu.appendChild(accessRightItem);
  
      var roleItem = document.createElement('a');
      roleItem.classList.add('dropdown-item');
      roleItem.innerHTML = `
          <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i> ${userInfo.role}
      `;
      dropdownMenu.appendChild(roleItem);
  
      var logoutItem = document.createElement('a');
      logoutItem.classList.add('dropdown-item');
      logoutItem.href = '#';
      logoutItem.id = 'logoutBtn';
      logoutItem.innerHTML = `
          <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
          Logout
      `;
      dropdownMenu.appendChild(logoutItem);
  }
  
      </script>
    <script
      src="https://cdn.tiny.cloud/1/otaxdnws7f1ne3p7541hih64t8gw8qgw87qg3k8i4b5oj9qx/tinymce/7/tinymce.min.js"
      referrerpolicy="origin"
    ></script>
    <script>
      document.getElementById("logoutBtn").addEventListener("click", function() {
  Swal.fire({
    title: "Bạn chắc chắn muốn đăng xuất?",
    text: "Bạn sẽ cần đăng nhập lại để tiếp tục sử dụng!",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#3085d6",
    cancelButtonColor: "#d33",
    confirmButtonText: "Đăng xuất",
    cancelButtonText: "Hủy",
  }).then((result) => {
    if (result.isConfirmed) {
      localStorage.removeItem("userInfo");
      window.location.href = "login.html";
    }
  });
});

    </script>
    <script>
      if (!localStorage.getItem("userInfo")) {
        window.location.href = "login.html";
      } else {
        const userInfo = JSON.parse(localStorage.getItem("userInfo"));
        const accessRight = userInfo.accessRight;
        const role = userInfo.role;

        if (role === "admin2") {
          if (
            window.location.href !== "http://127.0.0.1:8081/admin/add-post.html" &&
            window.location.href !== "http://127.0.0.1:8081/admin/index.html"
          ) {
            Swal.fire({
              icon: "error",
              title: "Truy cập bị từ chối",
              text: "Bạn không có quyền truy cập vào trang này!",
              customClass: {
                popup: "small-alert",
              },
            }).then(() => {
              window.location.href = "index.html";
            });
          }
        } else if (role === "content moderation") {
        }
      }
    </script>
    

    <script>
        let postId
      tinymce.init({
        selector: "textarea",
        plugins:
          "anchor autolink charmap codesample emoticons image link lists media searchreplace table visualblocks wordcount checklist mediaembed casechange export formatpainter pageembed linkchecker a11ychecker tinymcespellchecker permanentpen powerpaste advtable advcode editimage advtemplate ai mentions tinycomments tableofcontents footnotes mergetags autocorrect typography inlinecss markdown",
        toolbar:
          "undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | link image media table mergetags | addcomment showcomments | spellcheckdialog a11ycheck typography | align lineheight | checklist numlist bullist indent outdent | emoticons charmap | removeformat",
        tinycomments_mode: "embedded",
        tinycomments_author: "Author name",
        mergetags_list: [
          { value: "First.Name", title: "First Name" },
          { value: "Email", title: "Email" },
        ],
        ai_request: (request, respondWith) =>
          respondWith.string(() =>
            Promise.reject("See docs to implement AI Assistant")
          ),
        init_instance_callback: function (editor) {
          const urlParams = new URLSearchParams(window.location.search);
          postId = urlParams.get("id");

          fetch(`http://localhost:8080/api/post/${postId}`)
            .then((response) => response.json())
            .then((data) => {
              document.getElementById("title").value = data.title;
              editor.setContent(data.content);
            })
            .catch((error) => console.error("Error:", error));
        },
      });

      document
        .getElementById("postForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const title = document.getElementById("title").value;
          const content = tinymce.activeEditor.getContent();
          const idAccount = 1;

          const postData = {
            title: title,
            content: content,
            idAccount: idAccount,
          };

          const formData = new FormData();
          formData.append(
            "post",
            new Blob([JSON.stringify(postData)], { type: "application/json" })
          );

          const thumbnailFile =
            document.getElementById("thumbnailUrl").files[0];
          formData.append("thumbnail", thumbnailFile);

          console.log(formData);
          fetch(`http://localhost:8080/api/post/${postId}`, {
            method: "PUT",
            body: formData,
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error("Failed to add post.");
              }
            })
            .then((data) => {
              Swal.fire({
                icon: "success",
                title: "Cập nhật bài đăng thành công",
                text: "Bài đăng đã được cập nhật thành công!",
                customClass: {
                  popup: "small-alert",
                },
              }).then(() => {
                window.location.href = "post-pending.html";
              });
            })
            .catch((error) => console.error("Error:", error));
        });
    </script>
  </body>
</html>
