<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Trang chủ quản trị</title>

    <!-- Custom fonts for this template-->
    <link href="./vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- end font -->

    <!-- Custom styles for this template-->
    <link href="./css/sb-admin-2.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body id="page-top">

    <!-- Page Wrapper -->
    <div id="wrapper">

        <!-- Sidebar -->
        <ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

            <!-- Sidebar - Brand -->
            <a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
                <div class="sidebar-brand-text mx-3">SKYNET</div>
            </a>

            <!-- Divider -->
            <hr class="sidebar-divider my-0">

            <!-- Nav Item - Dashboard -->
            <li class="nav-item active">
                <a class="nav-link" href="index.html">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    <span>Dashboard</span></a>
            </li>

            <!-- Divider -->
            <hr class="sidebar-divider">

            <!-- Heading -->
            <div class="sidebar-heading">
                Interface
            </div>

            <!-- Nav Item - Pages Collapse Menu -->
        <li class="nav-item">
            <a
              class="nav-link collapsed"
              href="#"
              data-toggle="collapse"
              data-target="#collapseTwo"
              aria-expanded="true"
              aria-controls="collapseTwo"
            >
              <i class="fas fa-fw fa-cog"></i>
              <span>Bài viết</span>
            </a>
            <div
              id="collapseTwo"
              class="collapse"
              aria-labelledby="headingTwo"
              data-parent="#accordionSidebar"
            >
              <div class="bg-white py-2 collapse-inner rounded">
                <a class="collapse-item" href="post-pending.html"
                  >Bài viết chờ duyệt</a
                >
                <a class="collapse-item" href="post-active.html"
                  >Bài viết đã duyệt</a
                ><a class="collapse-item" href="add-post.html">Thêm bài viết</a>
              </div>
            </div>
          </li>
        </ul>
        <!-- End of Sidebar -->

        <!-- Content Wrapper -->
        <div id="content-wrapper" class="d-flex flex-column">
            <!-- Topbar -->
          <nav
          class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow"
        >
          <!-- Sidebar Toggle (Topbar) -->
          <button
            id="sidebarToggleTop"
            class="btn btn-link d-md-none rounded-circle mr-3"
          >
            <i class="fa fa-bars"></i>
          </button>

          <!-- Topbar Navbar -->
          <ul class="navbar-nav ml-auto">
            <!-- Nav Item - Search Dropdown (Visible Only XS) -->
            <li class="nav-item dropdown no-arrow d-sm-none">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="searchDropdown"
                role="button"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fas fa-search fa-fw"></i>
              </a>
              <!-- Dropdown - Messages -->
              <div
                class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                aria-labelledby="searchDropdown"
              >
                <form class="form-inline mr-auto w-100 navbar-search">
                  <div class="input-group">
                    <input
                      type="text"
                      class="form-control bg-light border-0 small"
                      placeholder="Search for..."
                      aria-label="Search"
                      aria-describedby="basic-addon2"
                    />
                    <div class="input-group-append">
                      <button class="btn btn-primary" type="button">
                        <i class="fas fa-search fa-sm"></i>
                      </button>
                    </div>
                  </div>
                </form>
              </div>
            </li>

            <div class="topbar-divider d-none d-sm-block"></div>

            <!-- Nav Item - User Information -->
            <li class="nav-item dropdown no-arrow">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="userDropdown"
                role="button"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <span class="mr-2 d-none d-lg-inline text-gray-600 small"
                  ></span
                >
                <img
                  class="img-profile rounded-circle"
                  src="img/undraw_profile.svg"
                />
              </a>
              <!-- Dropdown - User Information -->
              <div
                class="dropdown-menu dropdown-menu-info dropdown-menu-right shadow animated--grow-in"
                aria-labelledby="userDropdown"
              >
                <div class="dropdown-divider"></div>
                <a
                  class="dropdown-item"
                  href="#"
                  id="logoutBtn"
                >
                  <i
                    class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"
                  ></i>
                  Logout
                </a>
              </div>
            </li>
          </ul>
        </nav>
        <!-- End of Topbar -->

            <!-- Main Content -->
            <div class="container-fluid pt-5">

                <!-- Page Heading -->
                <h1 class="h3 mb-2 text-gray-800">Bài viết đã duyệt</h1>

                <!-- DataTales Example -->
                <div class="card shadow mb-4">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="postTable" width="100%" cellspacing="0">
                                <thead>
                                    <tr>
                                        <th>Id bài đăng</th>
                                        <th>Tiêu đề</th>
                                        <th>Thời gian</th>
                                        <th>Id tài khoản</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="postTableBody">

                                </tbody>
                            </table>
                            <nav aria-label="..." class="mt-5 pagination-custom">
                                <ul class="pagination justify-content-end">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1"><i
                                                class="fas fa-solid fa-chevron-left"></i></a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="./news.html?pageNumber=1&pageSize=6">1</a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="./news.html?pageNumber=2&pageSize=6">2 <span
                                                class="sr-only">(current)</span></a>
                                    </li>
                                    <li class="page-item">
                                        <a class="page-link" href="#"><i class="fas fa-solid fa-chevron-right"></i></a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

            </div>
            <!-- /.container-fluid -->
            <!-- Footer -->
            <footer class="sticky-footer bg-white">
                <div class="container my-auto">
                    <div class="copyright text-center my-auto">
                        <span>Trang quản trị của web tech.</span>
                    </div>
                </div>
            </footer>
            <!-- End of Footer -->
        </div>
        <!-- End of Main Content -->

    </div>
    <!-- End of Content Wrapper -->

    </div>
    <!-- End of Page Wrapper -->

    <!-- Scroll to Top Button-->
    <a class="scroll-to-top rounded" href="#page-top">
        <i class="fas fa-angle-up"></i>
    </a>

    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
                    <a class="btn btn-primary" href="login.html">Logout</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap core JavaScript-->
    <script src="./vendor/jquery/jquery.min.js"></script>
    <script src="./vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Core plugin JavaScript-->
    <script src="./vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Custom scripts for all pages-->
    <script src="./js/sb-admin-2.min.js"></script>

    <!-- Page level plugins -->
    <script src="./vendor/chart.js/Chart.min.js"></script>

    <!-- Page level custom scripts -->
    <script src="./js/demo/chart-area-demo.js"></script>
    <script src="./js/demo/chart-pie-demo.js"></script>
    <script>
      var userInfo = JSON.parse(localStorage.getItem('userInfo'));
      if (userInfo) {
 
    document.querySelector('.text-gray-600.small').textContent = userInfo.name;

    var dropdownMenu = document.querySelector('.dropdown-menu-info');
    console.log(dropdownMenu)
    dropdownMenu.innerHTML = '';

    var accessRightItem = document.createElement('a');
    accessRightItem.classList.add('dropdown-item');
    accessRightItem.innerHTML = `
        <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i> ${userInfo.accessRight}
    `;
    dropdownMenu.appendChild(accessRightItem);

    var roleItem = document.createElement('a');
    roleItem.classList.add('dropdown-item');
    roleItem.innerHTML = `
        <i class="fas fa-cogs fa-sm fa-fw mr-2 text-gray-400"></i> ${userInfo.role}
    `;
    dropdownMenu.appendChild(roleItem);

    var logoutItem = document.createElement('a');
    logoutItem.classList.add('dropdown-item');
    logoutItem.href = '#';
    logoutItem.id = 'logoutBtn';
    logoutItem.innerHTML = `
        <i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
        Logout
    `;
    dropdownMenu.appendChild(logoutItem);
}

    </script>
    <script>
        document.getElementById("logoutBtn").addEventListener("click", function() {
    Swal.fire({
      title: "Bạn chắc chắn muốn đăng xuất?",
      text: "Bạn sẽ cần đăng nhập lại để tiếp tục sử dụng!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#3085d6",
      cancelButtonColor: "#d33",
      confirmButtonText: "Đăng xuất",
      cancelButtonText: "Hủy",
    }).then((result) => {
      if (result.isConfirmed) {
        localStorage.removeItem("userInfo");
        window.location.href = "login.html";
      }
    });
  });
  
      </script>
    <script>
        if (!localStorage.getItem("userInfo")) {
          window.location.href = "login.html";
        } else {
          const userInfo = JSON.parse(localStorage.getItem("userInfo"));
          const accessRight = userInfo.accessRight;
          const role = userInfo.role;
      
          if (role === "admin2") {
            if (
              window.location.href !== "http://127.0.0.1:8081/admin/add-post.html" &&
              window.location.href !== "http://127.0.0.1:8081/admin/index.html"
            ) {
              Swal.fire({
                icon: "error",
                title: "Truy cập bị từ chối",
                text: "Bạn không có quyền truy cập vào trang này!",
                customClass: {
                  popup: "small-alert",
                },
              }).then(() => {
                window.location.href = "index.html";
              });
            }
          } else if (role === "content moderation") {
          }
        }
      </script>
      
    <script>
      function formatTimeline(timeline) {
    const timelineDate = new Date(timeline);
    const formattedTimeline = `${timelineDate.getDate()}/${timelineDate.getMonth() + 1}/${timelineDate.getFullYear()} ${timelineDate.getHours()}:${timelineDate.getMinutes()}:${timelineDate.getSeconds()}`;
    return formattedTimeline;
}
        function loadData(pageNumber, pageSize) {
            fetch(`http://localhost:8080/api/post/getByStatus?status=approve&pageNumber=${pageNumber}&pageSize=${pageSize}`)
                .then(response => response.json())
                .then(data => {
                    const postTableBody = document.getElementById('postTableBody');
                    postTableBody.innerHTML = '';
                    if (data && data.content.length > 0) {
                        data.content.forEach(post => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                        <td>${post.idPost}</td>
                        <td>${post.title}</td>
                        <td>${formatTimeline(post.timeline)}</td>
                        <td>${post.idAccount}</td>
                        <td class="d-flex align-items-center">
                            <button class="btn btn-primary approve-btn" style="text-wrap: nowrap; margin-right: 10px" data-id="${post.idPost}">Xoá bài</button>
                            <a class="btn btn-success edit-btn" style="text-wrap: nowrap" href="edit-post.html?id=${post.idPost}">Sửa bài</a>
                        </td>
        </td>
                    `;
                            postTableBody.appendChild(row);
                        });
                    } else {
                        postTableBody.innerHTML = '<tr><td colspan="4" class="text-center">No data available</td></tr>';
                    }

                    updatePagination(pageNumber, pageSize, data.total);
                })
                .catch(error => {
                    console.error('Error:', error);
                    const postTableBody = document.getElementById('postTableBody');
                    postTableBody.innerHTML = '<tr><td colspan="4" class="text-center">Failed to load data</td></tr>';
                });
        }


        function calculateTotalPages(totalPosts, pageSize) {
            return Math.ceil(totalPosts / pageSize);
        }
        function createPaginationLinks(totalPages, currentPage, pageSize) {
            const paginationContainer = document.querySelector('.pagination');
            paginationContainer.innerHTML = '';

            const previousButton = document.createElement('li');
            previousButton.classList.add('page-item');
            if (currentPage === 1) {
                previousButton.classList.add('disabled');
            }
            const previousLink = document.createElement('a');
            previousLink.classList.add('page-link');
            previousLink.href = `./post-pending.html?pageNumber=${currentPage - 1}&pageSize=${pageSize}`;
            previousLink.setAttribute('tabindex', '-1');
            previousLink.innerHTML = '<i class="fas fa-solid fa-chevron-left"></i>';
            previousButton.appendChild(previousLink);
            paginationContainer.appendChild(previousButton);

            for (let i = 1; i <= totalPages; i++) {
                (function (pageNumber) {
                    const pageButton = document.createElement('li');
                    pageButton.classList.add('page-item');
                    if (pageNumber === currentPage) {
                        pageButton.classList.add('active');
                    }
                    const pageLink = document.createElement('a');
                    pageLink.classList.add('page-link');
                    pageLink.href = `./post-pending.html?pageNumber=${pageNumber}&pageSize=${pageSize}`;
                    pageLink.textContent = pageNumber;
                    pageLink.addEventListener('click', function () {
                        loadData(pageNumber, pageSize);
                    });
                    pageButton.appendChild(pageLink);
                    paginationContainer.appendChild(pageButton);
                })(i);
            }


            const nextButton = document.createElement('li');
            nextButton.classList.add('page-item');
            if (currentPage === totalPages) {
                nextButton.classList.add('disabled');
            }
            const nextLink = document.createElement('a');
            nextLink.classList.add('page-link');
            nextLink.href = `./post-pending.html?pageNumber=${currentPage + 1}&pageSize=${pageSize}`;
            nextLink.innerHTML = '<i class="fas fa-solid fa-chevron-right"></i>';
            nextButton.appendChild(nextLink);
            paginationContainer.appendChild(nextButton);
        }

        function updatePagination(pageNumber, pageSize, totalPosts) {
            const totalPages = calculateTotalPages(totalPosts, pageSize);
            createPaginationLinks(totalPages, pageNumber, pageSize);
        }

        const urlParams = new URLSearchParams(window.location.search);
        const pageNumber = parseInt(urlParams.get("pageNumber") || 1);
        const pageSize = parseInt(urlParams.get("pageSize") || 6);
        loadData(pageNumber, pageSize);

    </script>
<script>document.addEventListener('click', function(e) {
    if (e.target && e.target.classList.contains('approve-btn')) {
        const postId = e.target.getAttribute('data-id');
        Swal.fire({
            title: 'Bạn có chắc chắn muốn xoá bài này?',
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Xoá',
            cancelButtonText: 'Hủy',
        }).then((result) => {
            if (result.isConfirmed) {
                fetch(`http://localhost:8080/api/post/${postId}`, {
                    method: 'DELETE',
                })
                .then(response => response)
                .then(data => {
                    loadData(pageNumber, pageSize);
                    Swal.fire('Xoá thành công!', '', 'success');
                })
                .catch(error => {
                    console.error('Error:', error);
                    Swal.fire('Đã xảy ra lỗi!', '', 'error');
                });
            }
        });
    }
});</script>
</body>

</html>