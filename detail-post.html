<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết bài viết</title>
    <!-- start font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- end font -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- start icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- end icon -->
    <link rel="stylesheet" href="styles/reset.css">
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/news.css">

</head>
<style>
    .comment-list {
        list-style: none;
        padding: 0;
    }

    .comment-item {
        margin-bottom: 20px;
        border: 1px solid #ccc;
        padding: 10px;
    }

    .comment-item .user {
        font-weight: bold;
        margin-bottom: 5px;
    }

    .comment-item .content {
        margin-left: 20px;
    }
</style>
<body>
    <header id="myHeader">
        <div class="container">
            <div class="header__logo">
                <a href="./">
                    <span>tech.</span>
                </a>
            </div>
            <div id="burger-menu">
                <span></span>
            </div>

            <div id="menu">
                <ul>
                    <li><a href="./">Trang chủ</a></li>
                    <li><a href="./price.html">Bảng giá</a></li>
                    <li><a href="./about.html">Về chúng tôi</a></li>
                    <li><a href="./news.html">Tin tức</a></li>
                </ul>
            </div>
            <div class="header__nav">
                <ul>
                    <li>
                        <a href="./">Trang chủ</a>
                    </li>
                    <li>
                        <a href="./price.html">Bảng giá</a>
                    </li>
                    <li>
                        <a href="./about.html">Về chúng tôi</a>
                    </li>
                    <li>
                        <a href="./news.html">Tin tức</a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <section class="news">
        <div class="new__bg"></div>
        
        </div>
    </section>
    <section class="detail-post">
        <div class="container">
            <h2 class="detail-post__title"></h2>
                <p class="detail-post__timeline"></p>
                <div class="detail-post__content"></div>
        </div>
    </section>
    <section class="comments mt-5">
        <div class="container">
            <form id="commentForm" class="mt-5">
                <!-- Thêm ô nhập username -->
                <div class="form-group">
                    <label for="username">Tên đăng nhập:</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <!-- Ô nhập bình luận -->
                <div class="form-group  mt-3">
                    <label for="comment">Bình luận của bạn:</label>
                    <textarea class="form-control" id="comment" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Gửi</button>
            </form>
            <h3 class="mb-3 mt-5">Bình luận</h3>
            <ul class="comment-list">
                <!-- Danh sách bình luận sẽ được hiển thị ở đây -->
            </ul>
        </div>
    </section>
    
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    <div class="footer__item">
                        <div class="header__logo__footer">
                            <span>tech.</span>
                        </div>
                        <p class="footer__sub">Mua Hosting giá rẻ khởi chạy ngay dự án của bạn với mức chi phí thấp nhất
                            nhưng tích hợp công
                            nghệ hiện đại nhất, NVMe
                            Web Hosting tại TinoHost tự tin khởi chạy mọi dự án website của bạn.</p>
                    </div>
                </div>
                <div class="col-12 col-lg-2">
                    <div class="footer__item">
                        <h3>Về tech.</h3>
                        <ul>
                            <li><span>Sứ mệnh</span></li>
                            <li><span>Giá trị cốt lỏi</span></li>
                            <li><span>Cột mốc chính</span></li>
                        </ul>
                    </div>
                </div>
                <div class="col-12 col-lg-2">
                    <div class="footer__item">
                        <h3>Tin tức</h3>
                        <ul>
                            <li><span>Tin tức mới nhất</span></li>
                            <li><span>Tin tức nổi bật</span></li>
                        </ul>
                    </div>
                </div>
                <div class="col-12 col-lg-2">
                    <div class="footer__item">
                        <h3>Liên hệ</h3>
                        <ul>
                            <li><span>Phone : 099******</span></li>
                            <li><span>Mail : tech@gmail.com</span></li>
                            <li><span>Văn phòng : 3/2, P. Xuân Khánh, Q. Ninh Kiều, TP. CT</span></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="line"></div>
            <p>© 2024 tech. All Rights Reserved</p>
        </div>
    </footer>
</body>
<script src="js/scroll_header.js"></script>
<script src="js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const postId = urlParams.get('id');

        async function fetchPostDetails() {
            const response = await fetch(`http://localhost:8080/api/post/${postId}`);
            const data = await response.json();
            return data;
        }

        async function displayPostDetails() {
            const post = await fetchPostDetails();

            console.log(post)

            const titleElement = document.querySelector('.detail-post__title');
            titleElement.textContent = post.title;


            const timelineElement = document.querySelector('.detail-post__timeline');
            timelineElement.textContent = post.timeline;

            const contentElement = document.querySelector('.detail-post__content');
            contentElement.innerHTML = post.content; 
        }
        async function fetchComments() {
            const response = await fetch(`http://localhost:8080/api/comment/${postId}`);
            const data = await response.json();
            return data;
        }

        async function displayComments() {
            const comments = await fetchComments();
            const commentList = document.querySelector('.comment-list');

            commentList.innerHTML = ''; // Clear existing comments

            comments.forEach(comment => {
                const li = document.createElement('li');
                li.classList.add('comment-item');

                const userSpan = document.createElement('span');
                userSpan.classList.add('user');
                userSpan.textContent = comment.nameuser;

                const contentSpan = document.createElement('span');
                contentSpan.classList.add('content');
                contentSpan.textContent = comment.content;

                li.appendChild(userSpan);
                li.appendChild(contentSpan);

                commentList.appendChild(li);
            });
        }


        displayPostDetails();
        displayComments();
    </script>
<script>
    document.getElementById("commentForm").addEventListener("submit", function(event) {
        event.preventDefault();

        // Lấy dữ liệu từ các trường nhập liệu
        const postId = getUrlParam('id');
        const nameuser = document.getElementById('username').value;
        const content = document.getElementById('comment').value;

        // Tạo object chứa dữ liệu bình luận
        const commentData = {
            "idPost": postId,
            "nameuser": nameuser,
            "content": content
        };

        fetch("http://localhost:8080/api/comment", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(commentData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error("Failed to add comment.");
            }
            console.log(response);
            // Hiển thị thông báo thành công
            Swal.fire({
                icon: 'success',
                title: 'Bình luận đã được gửi thành công!',
                showConfirmButton: false,
                timer: 1500
            });
            // Đặt lại biểu mẫu
            document.getElementById("commentForm").reset();
            displayComments();
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Có lỗi xảy ra khi gửi bình luận.");
        });
    });


    function getUrlParam(paramName) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(paramName);
    }
</script>

</html>